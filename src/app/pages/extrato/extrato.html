<div
  class="container p-2"
  [class.visually-hidden]="controleService.carregando()"
>
  <mat-card
    class="p-2"
    appearance="filled"
    (click)="navegarPainelFaturas()"
    role="button"
    tabindex="0"
    (keydown.enter)="navegarPainelFaturas()"
    (keydown.space)="navegarPainelFaturas()"
    aria-label="Ver painel de faturas"
  >
    <mat-card-header class="p-0 d-flex justify-content-center">
      <mat-card-title>{{
        faturaService.faturaAtiva().nome_fatura || "Nenhuma fatura selecionada"
      }}</mat-card-title>
    </mat-card-header>
    <mat-card-content class="p-0 text-center">
      @if(faturaService.faturaAtiva().codigo_fatura) {
      {{
        faturaService.faturaAtiva().data_abertura_fatura.toBrazilianDateString()
      }}
      -
      {{
        faturaService
          .faturaAtiva()
          .data_fechamento_fatura.toBrazilianDateString()
      }}
      } @else { Mostrando compras dos últimos 30 dias }
    </mat-card-content>
  </mat-card>
</div>

<div
  class="container p-2 pt-0"
  [class.visually-hidden]="
    controleService.carregando() || dataSource.data.length
  "
>
  <mat-card appearance="filled">
    <mat-card-content class="text-center">
      <mat-icon
        color="primary"
        style="font-size: 40px; height: 40px; width: 40px"
        >info</mat-icon
      >
      <p class="mt-2 mb-0">Você não possui nenhuma compra neste período.</p>
      <p>
        Além do botão abaixo, é possível adicionar uma compra a qualquer momento
        pelo menu.
      </p>
    </mat-card-content>
    <mat-card-actions>
      <button class="w-100" matButton="filled" routerLink="/inserir-compra">
        Nova compra
      </button>
    </mat-card-actions>
  </mat-card>
</div>

<div
  class="container p-2 pt-0"
  [class.visually-hidden]="
    controleService.carregando() || !dataSource.data.length
  "
>
  <mat-card appearance="filled">
    <mat-card-content class="p-2">
      <table
        mat-table
        [dataSource]="dataSource"
        style="background-color: transparent"
      >
        <ng-container matColumnDef="codigo_categoria_compra">
          <th
            class="p-2"
            mat-header-cell
            *matHeaderCellDef
            style="width: 40px"
          ></th>
          <td class="p-2" mat-cell *matCellDef="let element">
            <mat-icon>{{ element.categoria_compra.icon }}</mat-icon>
          </td>
        </ng-container>
        <ng-container matColumnDef="descricao_compra">
          <th class="p-0" mat-header-cell *matHeaderCellDef>
            <b>{{ titulo }}</b>
          </th>
          <td class="p-0" mat-cell *matCellDef="let element">
            <span>{{ element.data_compra.toLocaleDateString("pt-br") }}</span>
            <br />
            <b>{{ element.descricao_compra.toUpperCase() }}</b>
          </td>
        </ng-container>
        <ng-container matColumnDef="valor_compra">
          <th class="p-2 text-center" mat-header-cell *matHeaderCellDef>
            {{
              compraService.somaCategoria(
                compraService.categoria_compra().codigo
              )
            }}
          </th>
          <td class="p-2 text-center" mat-cell *matCellDef="let element">
            {{ element.valor_compra.toBrl() }}
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="columns"></tr>
        <tr
          mat-row
          (click)="detalhar(element)"
          *matRowDef="let element; columns: columns"
        ></tr>
      </table>
    </mat-card-content>
  </mat-card>
</div>
